<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwillbs.keanu_coffee.admin.mapper.EmployeeManagementMapper">
	<!-- 로그인용 아이디로 회원정보 조회 -->
	<select id="selectEmployeeInfoById" resultType="EmployeeInfoDTO">
		SELECT 
			emp_idx
			, emp_no
			, emp_name
			, emp_gender
			, department_idx
			, team_idx
			, role_idx
			, emp_phone
			, emp_email
			, emp_password
			, hire_date
			, emp_status
		FROM
			EMPLOYEE_INFO
		WHERE
			emp_no = #{empNo}
	</select>
	
	
	<!-- 직원 수 조회 -->
	<select id="countEmployee" resultType="int">
		SELECT count(*)
		FROM V_EMPLOYEE_FULL_INFO
		<if test="searchType != ''">
		WHERE
			${searchType} LIKE CONCAT('%', #{searchKeyword}, '%')
		</if>
		
	</select>
	
	<!-- 직원목록조회 -->
	<select id="selectEmployeeList" resultType="EmployeeInfoDTO">
		SELECT *
		FROM V_EMPLOYEE_FULL_INFO
			<if test="searchType != ''">
			WHERE
				${searchType} LIKE CONCAT('%', #{searchKeyword}, '%')
			</if>
			<if test="orderKey != ''">
			ORDER BY ${orderKey} ${orderMethod}			
			</if>
		LIMIT
			#{startRow}
			, #{listLimit}
	</select>
	
	<!-- 단일 회원 정보 검색 -->
	<select id="selectEmployeeInfo" resultType="EmployeeInfoDTO" >
		SELECT *
		FROM V_EMPLOYEE_FULL_INFO
		WHERE emp_id = #{empId}
	</select>
	
	<!-- 회원추가 -->
	<insert id="insertEmployeeInfo" useGeneratedKeys="true" keyProperty="idx">
		INSERT INTO EMPLOYEE_INFO
		VALUES(
			null
			, #{empNo}
			, #{empName}
			, #{empGender}
			, COALESCE(#{departmentIdx}, 1)
			, COALESCE(#{teamIdx}, 1)
			, COALESCE(#{roleIdx}, 1)
			, #{empPhone}
			, #{empEmail}
			, #{empId}
			, #{empPassword}
			, #{hireDate}
			, default
			, default
			, default
		)
	</insert>
	
	<!-- 직책 비우기 -->
	<update id="updateRoleToNull">
		UPDATE EMPLOYEE_INFO
		SET role_idx = NULL
		WHERE role_idx = #{roleIdx}
	</update>
	
	<!-- 팀비우기 -->
	<update id="updateTeamToNull">
		UPDATE EMPLOYEE_INFO
		SET team_idx = NULL
		WHERE team_idx = #{teamIdx}
	</update>
	
	<!-- 부서, 팀, 직책 비우기 -->
	<update id="updateDeptTeamRoleToNull">
		UPDATE EMPLOYEE_INFO
		SET team_idx = NULL,
			role_idx = NULL,
			department_idx = NULL
		WHERE department_idx = #{departmentIdx}
	</update>
	
	<!-- idx로 회원정보 조회하기 -->
	<select id="selectOneEmployeeInfoByEmpIdx" resultType="EmployeeInfoDTO">
		SELECT *
		FROM V_EMPLOYEE_FULL_INFO
		WHERE idx = #{empIdx}
	</select>
	
	<!--  회원정보 업데이트하기 -->
	<update id="updateEmployeeInfo" parameterType="com.itwillbs.keanu_coffee.admin.dto.EmployeeInfoDTO">
    UPDATE EMPLOYEE_INFO
    <set>
        <if test="empPhone != null and empPhone != ''">
            emp_phone = #{empPhone},
        </if>
        <if test="empEmail != null">
            emp_email = #{empEmail},
        </if>
        <if test="empPassword != null and empPassword != ''">
            emp_password = #{empPassword},
        </if>
        <if test="empStatus != null and empStatus != ''">
            emp_status = #{empStatus},
        </if>
    </set>
    WHERE idx = #{empIdx}
</update>
	
</mapper>
